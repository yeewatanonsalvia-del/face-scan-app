<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI FaceScan - Access Control</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        /* GENERAL STYLES - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö AI/Security */
        body {
            font-family: 'Orbitron', sans-serif;
            background: #000000; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó */
            color: #E0E0E0;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #00FFC0; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏¥‡πâ‡∏ô‡∏ï‡πå/‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
            text-align: center;
            margin-bottom: 30px;
            font-size: 3.2rem;
            text-shadow: 0 0 15px rgba(0, 255, 192, 0.8); /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô */
            letter-spacing: 3px;
        }

        .container {
            background: rgba(10, 10, 10, 0.95); /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° */
            border-radius: 8px;
            padding: 40px;
            border: 2px solid rgba(0, 255, 192, 0.3); /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏°‡∏µ‡πÅ‡∏™‡∏á */
            box-shadow: 0 0 30px rgba(0, 255, 192, 0.1);
            max-width: 1400px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
            width: 100%;
            display: flex;
            flex-wrap: wrap; /* ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö */
            gap: 30px;
        }

        /* CONTROL AND STATUS PANEL */
        .controls {
            flex-basis: 100%; /* ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
            text-align: center;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(45deg, #00FFC0, #00BFFF);
            color: #000000;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 192, 0.6);
        }

        button:hover {
            transform: scale(1.03);
            box-shadow: 0 0 25px #00FFC0, 0 0 40px #00BFFF;
        }

        /* WEBCAM & DETECTED SECTION */
        .camera-area {
            flex: 2; /* ‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ù‡∏±‡πà‡∏á Log */
            min-width: 650px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #webcam-container canvas {
            border-radius: 10px;
            border: 3px solid #00FFC0;
            box-shadow: 0 0 30px rgba(0, 255, 192, 0.5); /* Glowing effect */
            width: 640px !important;
            height: 640px !important;
        }

        /* REAL-TIME PREDICTION TEXT */
        .prediction {
            background: rgba(30, 30, 30, 0.8);
            color: #FF00FF;
            padding: 15px 30px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            border: 1px solid #FF00FF;
            box-shadow: 0 0 10px #FF00FF;
            display: none;
            width: 100%;
            box-sizing: border-box;
        }

        .detected-name {
            font-size: 36px;
            font-weight: bold;
            color: #00FFC0;
            text-align: center;
            padding: 25px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 3px solid #00FFC0;
            animation: glow 1.5s ease-in-out infinite alternate;
            text-shadow: 0 0 15px #00FFC0;
        }

        /* STATUS DISPLAY */
        .status {
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 1px;
            flex-basis: 100%;
        }

        .status.loading {
            background-color: #333300;
            color: #FFFF00;
            border: 1px solid #FFFF00;
        }

        .status.ready {
            background-color: #00331a;
            color: #00FFC0;
            border: 1px solid #00FFC0;
        }

        .status.success {
            background-color: #004d33;
            color: #FFFFFF;
            font-size: 22px;
            border: 2px solid #00FFC0;
            animation: pulse 1s ease-in-out infinite alternate;
        }
        
        /* ATTENDANCE LOG */
        .attendance-area {
            flex: 1; /* ‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á */
            min-width: 350px;
        }

        .attendance-log {
            height: 100%;
            border: 1px solid #222;
            border-radius: 5px;
            padding: 20px;
            background: #111;
        }

        .attendance-log h3 {
            color: #00FFC0;
            border-bottom: 2px solid #00FFC0;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .log-entry {
            padding: 12px;
            margin: 8px 0;
            background: #222;
            border-radius: 4px;
            border-left: 5px solid #00FFC0;
            font-size: 15px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .log-entry.success {
            background: #006633;
            color: #FFFFFF;
            border-left: 5px solid #33FF33;
            opacity: 1;
            font-weight: bold;
        }

        /* KEYFRAME ANIMATIONS */
        @keyframes glow {
            from { box-shadow: 0 0 5px #00FFC0; }
            to { box-shadow: 0 0 25px #00FFC0, 0 0 35px #00FFC0; }
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 5px #00FFC0; }
            100% { transform: scale(1.02); box-shadow: 0 0 25px #00FFC0; }
        }
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Media Query ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) */
@media (max-width: 800px) {
    
    .container {
        padding: 15px;
        flex-direction: column; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
        gap: 20px;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
    .camera-area {
        min-width: 100%; /* ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà */
    }

    #webcam-container canvas {
        width: 300px !important; 
        height: 300px !important;
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏î‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
    .detected-name {
        font-size: 24px;
        padding: 15px;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
    .status {
        font-size: 14px;
        padding: 10px;
    }

    .attendance-area {
        min-width: 100%;
    }
}
    </style>
</head>
<body>
    <h1>üéØ FACE CHECK</h1>
    
    <div class="container">
        
        <div id="status" class="status loading">‡∏Ñ‡∏•‡∏¥‡∏Å '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>

        <div class="camera-area">
            <div id="webcam-container"></div>
            <div id="label-container"></div>
            <div id="detected-person" style="display: none;"></div>
            <div class="controls">
                <button onclick="init()" id="start-btn">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
        
        <div class="attendance-area">
            <div class="attendance-log">
                <h3>üìã Access Log</h3>
                <div id="attendance-list">
                    <div class="log-entry">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤...</div>
                </div>
            </div>
        </div>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

    <script>
        // URL ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const URL = "https://teachablemachine.withgoogle.com/models/PUy7hzmCfu/";

        let model, webcam, labelContainer, maxPredictions;
        let isModelLoaded = false;
        let attendanceLog = [];
        let lastDetectedPerson = null; // Cooldown/‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πâ‡∏≥
        let currentPredictionDiv = null;

        async function init() {
            try {
                updateStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...", "loading");
                
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";

                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                const flip = true;
                webcam = new tmImage.Webcam(640, 640, flip);
                
                await webcam.setup({ facingMode: "user" });
                await webcam.play();
                
                document.getElementById("webcam-container").appendChild(webcam.canvas);
                labelContainer = document.getElementById("label-container");
                
                const div = document.createElement("div");
                div.className = "prediction";
                div.id = "detected-face";
                labelContainer.appendChild(div);
                currentPredictionDiv = div;

                isModelLoaded = true;
                updateStatus("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤...", "ready");
                
                window.requestAnimationFrame(loop);
                
            } catch (error) {
                console.error("Error loading model:", error);
                updateStatus("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö: " + error.message, "error");
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {
            if (!isModelLoaded) return;

            try {
                const prediction = await model.predict(webcam.canvas);
                let highestPrediction = null;
                let highestProbability = 0;
                
                for (let i = 0; i < maxPredictions; i++) {
                    const probability = prediction[i].probability;
                    const className = prediction[i].className;
                    
                    if (probability > highestProbability) {
                        highestProbability = probability;
                        highestPrediction = className;
                    }
                }
                
                // --- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ Thresholds (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) ---
                const CONFIDENCE_THRESHOLD_RECORD = 0.90; // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à 90% ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                const CONFIDENCE_THRESHOLD_SHOW = 0.70;   // 70% ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
                if (highestProbability >= CONFIDENCE_THRESHOLD_SHOW && highestPrediction !== "Unknown") {
                    
                    // ‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á
                    currentPredictionDiv.innerHTML = `üë§ IDENTITY: ${highestPrediction} [${(highestProbability * 100).toFixed(1)}%]`;
                    currentPredictionDiv.classList.add("show");

                    // --- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Recording Logic) ---
                    if (highestProbability >= CONFIDENCE_THRESHOLD_RECORD) {
                        
                        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πâ‡∏≥)
                        if (highestPrediction === lastDetectedPerson) {
                            return; 
                        }
                        
                        // ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
                        lastDetectedPerson = highestPrediction; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Cooldown/‡∏Ñ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                        showDetectedPerson(highestPrediction);
                        recordAttendance(highestPrediction, highestProbability);
                        
                    } else {
                        // ‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 90%
                        if (lastDetectedPerson === null) {
                            updateStatus("üü° ‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥...", "loading");
                        }
                    }
                    
                } else { 
                    // --- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤/‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å (Unknown/Low Confidence) ---
                    
                    currentPredictionDiv.innerHTML = `üö´ ACCESS DENIED / UNKNOWN`;
                    currentPredictionDiv.classList.add("show");
                    
                    // ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß
                    if (lastDetectedPerson !== null) {
                        lastDetectedPerson = null; // ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Cooldown
                        hideDetectedPerson();
                    }
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    updateStatus("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤...", "ready");
                }
                
            } catch (error) {
                console.error("Prediction error:", error);
                updateStatus("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢: " + error.message, "error");
            }
        }

        function showDetectedPerson(name) {
            const detectedDiv = document.getElementById("detected-person");
            detectedDiv.innerHTML = `
                <div class="detected-name">
                    ACCESS GRANTED: ${name}<br>
                    <span style="font-size: 18px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</span>
                </div>
            `;
            detectedDiv.style.display = "block";
            updateStatus(`üéâ ACCESS GRANTED: ${name} - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`, "success");
        }

        function hideDetectedPerson() {
            const detectedDiv = document.getElementById("detected-person");
            detectedDiv.style.display = "none";
            updateStatus("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤...", "ready");
        }

        function recordAttendance(name, confidence) {
            const now = new Date();
            const timeStr = now.toLocaleString('th-TH');
            
            const entry = {
                name: name,
                time: timeStr,
                confidence: (confidence * 100).toFixed(1),
                timestamp: now
            };
            
            attendanceLog.push(entry);
            updateAttendanceList();
            sendToGoogleSheets(entry);
        }

        function updateAttendanceList() {
            const listElement = document.getElementById("attendance-list");
            listElement.innerHTML = "";
            
            const recentEntries = attendanceLog.slice(-10).reverse();
            
            recentEntries.forEach((entry, index) => {
                const div = document.createElement("div");
                div.className = index === 0 ? "log-entry success" : "log-entry";
                div.innerHTML = `
                    <strong>[TIME: ${entry.time.split(',')[1].trim()}]</strong> 
                    <span style="float: right;">ID: ${entry.name}</span>
                `;
                listElement.appendChild(div);
            });
            
            if (attendanceLog.length === 0) {
                listElement.innerHTML = '<div class="log-entry">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤...</div>';
            }
        }

        function updateStatus(message, type) {
            const statusElement = document.getElementById("status");
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        async function sendToGoogleSheets(entry) {
            try {
                // URL Web App Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏∑‡∏° Deploy ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î Apps Script)
                const WEBAPP_URL = "https://script.google.com/macros/s/AKfycby8ljYx76YYaZGt5gh3hv8_V11jVqWhTtb6Fsw2cx9hsIA7sQtPVrEAVl-baJnktI4-dw/exec";
                
                const urlWithParams = `${WEBAPP_URL}?name=${encodeURIComponent(entry.name)}&time=${encodeURIComponent(entry.time)}&confidence=${encodeURIComponent(entry.confidence)}`;
                
                console.log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets");

                // ‡πÉ‡∏ä‡πâ mode: 'no-cors' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 'Failed to fetch' ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Local Server
                const response = await fetch(urlWithParams, {
                    method: 'GET',
                    mode: 'no-cors' 
                });

                console.log("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å no-cors)");
                
            } catch (error) {
                console.error("Error sending to Google Sheets:", error);
                // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢ alert ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
            }
        }

        window.addEventListener('load', function() {
            updateStatus("‡∏Ñ‡∏•‡∏¥‡∏Å '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", "loading");
        });
    </script>
</body>
</html>
